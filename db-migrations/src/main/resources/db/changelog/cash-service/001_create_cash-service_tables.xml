<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.xsd">

    <changeSet id="20250818-cash-1" author="grok">
        <sql>
            CREATE TABLE cash.transactions (
                                               id             UUID PRIMARY KEY,
                                               account_id     UUID NOT NULL,
                                               amount         DECIMAL(19,4) NOT NULL,
                                               operation_type VARCHAR(10)   NOT NULL CHECK (operation_type IN ('DEPOSIT','WITHDRAW')),
                                               status         VARCHAR(20)   NOT NULL DEFAULT 'COMPLETED' CHECK (status IN ('PENDING','COMPLETED','FAILED')),
                                               created_at     TIMESTAMPTZ   NOT NULL DEFAULT CURRENT_TIMESTAMP,
                                               updated_at     TIMESTAMPTZ
            );
            CREATE INDEX idx_transactions_account_id ON cash.transactions(account_id);
            CREATE INDEX idx_transactions_acc_ca ON cash.transactions(account_id, created_at);
        </sql>
        <rollback>
            DROP INDEX IF EXISTS cash.idx_transactions_acc_ca;
            DROP INDEX IF EXISTS cash.idx_transactions_account_id;
            DROP TABLE cash.transactions;
        </rollback>
    </changeSet>


</databaseChangeLog>